{% extends "base.html" %}

{% block content %}

<h2>Tabela PROGRAMARE UTILAJE</h2>
<script>
document.addEventListener("DOMContentLoaded", function() {

    const start = document.getElementById("data_start");
    const end = document.getElementById("data_end");

    start.addEventListener("change", function() {
        end.min = start.value;

        if (end.value && end.value < start.value) {
            end.value = start.value;
        }
    });

    end.addEventListener("change", function() {
        start.max = end.value;

        if (start.value && start.value > end.value) {
            start.value = end.value;
        }
    });

});
</script>

<form action="/programare_utilaje/add" method="post" class="form-table">

<div class="form-group">
<label>Utilaj</label>
<select name="utilaj" required>
{% for u in utilaje %}
<option value="{{u[0]}}">
{{u[1]}}
</option>
{% endfor %}
</select>
</div>

<div class="form-group">
<label>Locație</label>
<select name="locatie" required>
{% for l in locatii %}
<option value="{{l[0]}}">
{{l[1]}} - {{l[2]}}
</option>
{% endfor %}
</select>
</div>

<div class="form-group">
<label>Dată început</label>
<input type="date" name="data_start" id="data_start" required>
</div>

<div class="form-group">
<label>Dată terminare</label>
<input type="date" name="data_end" id="data_end" required>
</div>

<div class="form-actions">
<button type="submit" class="btn-primary">
Adaugă
</button>
</div>

</form>

<hr>
<script>
document.addEventListener("DOMContentLoaded", function() {

    document.querySelectorAll("tr").forEach(row => {

        const start = row.querySelector(".data_start");
        const end = row.querySelector(".data_end");

        if (!start || !end) return;

        function validate() {
            if (start.value) end.min = start.value;
            if (end.value) start.max = end.value;

            if (start.value && end.value && start.value > end.value) {
                end.setCustomValidity("Data de terminare trebuie să fie după data de început!");
            } else {
                end.setCustomValidity("");
            }
        }

        start.addEventListener("change", validate);
        end.addEventListener("change", validate);

        validate();

    });

});
</script>

<div class="table-wrapper">

<table border="1">
<tr>
<th>Utilaj</th>
<th>Locație</th>
<th>Dată început</th>
<th>Dată terminare</th>
<th>Acțiuni</th>
</tr>

{% for p in programari %}
<tr>

<td>{{p[1]}}</td>
<td>{{p[3]}} - {{p[4]}}</td>

<td>
<form action="/programare_utilaje/update/{{p[0]}}/{{p[2]}}" method="post">

<input type="date"
       name="data_start"
       class="data_start"
       value="{{p[5].strftime('%Y-%m-%d')}}"
       required>

</td>

<td>
<input type="date"
       name="data_end"
       class="data_end"
       value="{{p[6].strftime('%Y-%m-%d')}}"
       required>
</td>

<td>
<div class="action-buttons">

<button type="submit" class="btn-primary small">
Actualizează
</button>

</form>

<form action="/programare_utilaje/delete/{{p[0]}}/{{p[2]}}" method="post">
<button type="submit" class="btn-danger small">
Șterge
</button>
</form>

</div>
</td>

</tr>
{% endfor %}

</table>
</div>

{% endblock %}